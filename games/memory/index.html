<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Retro Progresivo</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
body{
  margin:0;
  background:#f5e6d3;
  font-family:'Press Start 2P',monospace;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
}
#gameBoard{
  display:grid;
  grid-gap:12px;
  background:#deb887;
  padding:12px;
  border:6px solid #a0522d;
  border-radius:12px;
  box-shadow:0 10px 20px rgba(0,0,0,0.5);
  position:relative;
}
.card{
  width:80px;
  height:80px;
  background:#fff3e0;
  border-radius:8px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:40px;
  cursor:pointer;
  user-select:none;
  transform-style: preserve-3d;
  transition: transform 0.4s;
}
.card.flipped{
  transform: rotateY(180deg) scale(1.1);
  background:#f5deb3;
}
.card.matched{
  animation: glow 0.5s ease-in-out;
}
@keyframes glow{
  0%{box-shadow:0 0 0 #fff;}
  50%{box-shadow:0 0 15px #fffa75;}
  100%{box-shadow:0 0 0 #fff;}
}
.overlay{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0.85);
  z-index:50;
  color:white;
  text-align:center;
}
.hidden{display:none;}
.btn{
  background:#a0522d;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:8px;
  cursor:pointer;
  font-family:'Press Start 2P';
}
#hud{
  position:absolute;
  top:12px;
  left:12px;
  background:rgba(0,0,0,0.5);
  padding:8px 12px;
  border-radius:8px;
  border:2px solid #a0522d;
  color:white;
  font-size:14px;
}
</style>
</head>
<body>
<div id="hud">Intentos: <span id="attempts">0</span> / <span id="maxAttempts">30</span> | Matches: <span id="matches">0</span> | Nivel: <span id="level">1</span></div>
<div id="gameBoard"></div>

<div id="start" class="overlay">
  <h2>MEMORY RETRO</h2>
  <button id="startBtn" class="btn">INICIAR</button>
</div>

<div id="end" class="overlay hidden">
  <h2>Â¡JUEGO TERMINADO!</h2>
  <p>Intentos: <span id="finalAttempts">0</span></p>
  <p>Matches: <span id="finalMatches">0</span></p>
  <p>Nivel alcanzado: <span id="finalLevel">0</span></p>
  <button id="restartBtn" class="btn">REINICIAR</button>
</div>

<script>
// Sonidos
const S = {
  flip: new Audio('music/flip.mp3'),
  match: new Audio('music/match.mp3'),
  fail: new Audio('music/fail.wav'),
  gameover: new Audio('music/gameover.mp3'),
  bg: new Audio('music/background.mp3')
};
S.flip.volume=0.2; S.match.volume=0.3; S.fail.volume=0.3; S.gameover.volume=0.4; S.bg.volume=0.2; S.bg.loop=true;

const boardEl = document.getElementById('gameBoard');
const startOverlay = document.getElementById('start');
const endOverlay = document.getElementById('end');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const attemptsEl = document.getElementById('attempts');
const matchesEl = document.getElementById('matches');
const levelEl = document.getElementById('level');
const finalAttemptsEl = document.getElementById('finalAttempts');
const finalMatchesEl = document.getElementById('finalMatches');
const finalLevelEl = document.getElementById('finalLevel');
const maxAttemptsEl = document.getElementById('maxAttempts');

const emojis = ['ðŸŽ','ðŸŒ','ðŸ‡','ðŸ’','ðŸ‰','ðŸ¥','ðŸ','ðŸ‘','ðŸ“','ðŸ¥‘','ðŸ¥¥','ðŸ','ðŸ‹','ðŸŠ','ðŸ¥­'];
let attempts=0, matches=0, level=1;
let firstCard=null, secondCard=null, lock=false;
let cards = [];
const maxAttempts = 30; // lÃ­mite de intentos

function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

function createBoard(){
  // Limpiar tablero y referencias anteriores
  boardEl.innerHTML='';
  cards = [];
  firstCard=null;
  secondCard=null;
  lock=false;

  const numPairs = Math.min(4 + level - 1, emojis.length);
  const double = [...emojis.slice(0,numPairs), ...emojis.slice(0,numPairs)];
  shuffle(double);

  const cols = Math.ceil(Math.sqrt(double.length));
  boardEl.style.gridTemplateColumns = `repeat(${cols}, 80px)`;

  double.forEach(emoji=>{
    const card = document.createElement('div');
    card.classList.add('card');
    card.dataset.emoji = emoji;
    card.textContent = ''; // vacÃ­o al inicio
    card.addEventListener('click', flipCard);
    boardEl.appendChild(card);
    cards.push(card);
  });

  attempts = 0;
  matches = 0;
  attemptsEl.textContent = attempts;
  matchesEl.textContent = matches;
  levelEl.textContent = level;
}

function flipCard(){
  if(lock || this.classList.contains('flipped') || this.classList.contains('matched')) return;
  try{S.flip.currentTime=0;S.flip.play();}catch(e){}
  this.classList.add('flipped');
  this.textContent=this.dataset.emoji;

  if(!firstCard){
    firstCard=this;
  } else {
    secondCard=this;
    lock=true;
    attempts++;
    attemptsEl.textContent=attempts;

    // Revisar lÃ­mite de intentos
    if(attempts >= maxAttempts){
      endGame();
      return;
    }

    const numPairs = Math.min(4 + level - 1, emojis.length);
    if(firstCard.dataset.emoji === secondCard.dataset.emoji){
      try{S.match.currentTime=0;S.match.play();}catch(e){}
      firstCard.classList.add('matched');
      secondCard.classList.add('matched');
      matches++;
      matchesEl.textContent=matches;
      firstCard=null; secondCard=null; lock=false;

      if(matches === numPairs){
        level++;
        setTimeout(createBoard,800); // nuevo nivel
      }
    } else {
      try{S.fail.currentTime=0;S.fail.play();}catch(e){}
      setTimeout(()=>{
        firstCard.classList.remove('flipped');
        firstCard.textContent='';
        secondCard.classList.remove('flipped');
        secondCard.textContent='';
        firstCard=null; secondCard=null; lock=false;
      },800);
    }
  }
}

function startGame(){
  startOverlay.classList.add('hidden');
  endOverlay.classList.add('hidden');
  level = 1;
  createBoard();
  try{S.bg.currentTime=0; S.bg.play();}catch(e){}
}

function endGame(){
  try{S.bg.pause();}catch(e){}
  finalAttemptsEl.textContent=attempts;
  finalMatchesEl.textContent=matches;
  finalLevelEl.textContent=level;
  endOverlay.classList.remove('hidden');
  try{S.gameover.currentTime=0;S.gameover.play();}catch(e){}
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);
</script>
</body>
</html>
